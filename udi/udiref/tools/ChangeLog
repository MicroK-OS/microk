2001-09-28  Robert Lipe  <robertl@caldera.com>

	* uw/udi_osdep.c (make_bcfg): Don't emit #ident.

2001-09-27  Minghui Jiang <ming@stg.com>

	* uw/udi_osdep.c (osdep_mkinst_files): Add '-f' to 'cp' to install 
	provided headers.
	
2001-09-27  Steven Bytnar  <sbytnar@stg.com>

	* uw/udi_osdep.c (osdep_mkinst_files): Fixed a bug that
	was causing the module's name to be executed instead of idcheck.

2001-09-26  Scott Popp   <spopp@caldera.com>

	* uw/osdep_make.c (osdep_mkinst_files): Correct an error due
	to a misinterpretation of the return code for 'idcheck -p'.

2001-09-23  Steven Bytnar  <sbytnar@stg.com>

	* linux/linux_override.c (os_compile): Changed include path from
	/usr/src/linux/ to /lib/modules/`uname -r`/build/.

2001-09-20  Scott Popp   <spopp@caldera.com>

	* uw/osdep_make.c (osdep_mkinst_files): Fix installf arguments to
	be correct, and invoke the proper options of idinstall, so resmgr
	entries get properly created for pseudo devices.

2001-09-17  Burkhard Daniel  <burk@stg.com>

	* linux/osdep_make.c (osdep_mkinst_files): Use default location of
	linux source tree from /lib/modules{kernel_version}/build rather than
	from /usr/src/linux. This is recommended behavior for newer kernels.

2001-09-16  Steven Bytnar  <sbytnar@stg.com>

	* darwin/osdep.h: Removed dependence on OS_GLUE_PROPS_STRUCT.
	Removed some flags from UDI_CCOPTS_ARCHINDEP and added
	more warnings to UDI_CCOPTS_DEBUG_FLAGS.
	* darwin/osdep_make.c: pv_count is more accurately understood
	as a way to detect a meta vs a driver.
	Removed dependence on write_props_glue.

2001-09-06  Robert Lipe  <robertl@caldera.com>

	* uw/osdep_make.c (make_glue): For UnixWare 7, don't provide glue
        if _load is already present.
        (osdep_mkinst_files): Adapt to make_glue change.   Lose
        dead `do_posix' code.

2001-09-05  Scott Popp  <spopp@caldera.com>

        * common/udisetup.c (main): Added code to allow the file
        specified by udisetup to contain paths.  This will allow
        udisetup to be run from a directory, other than the directory
        the *.udi file is in.

2001-09-05  Robert Lipe  <robertl@caldera.com>
 
        * Makefile (MKPKGOBJS): Add OS_COMMON_OBJS.
        (MKBLDOBJS): Likewise.
        (MKSETOBJS): Likewise.
        * common/param.c (UDI_Util_Get_Params): Test for mapper.  Allow
        OS_OVERRIDE_PARAMS.
        * uw/osdep.h (UDI_CCOPTS_DEFAULT_MAPPER_OPTS): Added.
        (UDI_CCOPTS_MAPPER.) Added.
        (OS_OVERRIDE_PARAMS): Added.
        * uw/osdep.mk (CC): Deleted.
        (LD): Likewise.
        (OS_COMMON_OBJS): New.
        * uw/params.c: New file.

2001-08-31  Robert Lipe  <robertl@caldera.com>

	* common/spparse.l (mapper): New.
	* common/spparse.y (MAPPER): New.
	* uw/osdep_make.c (driver_had_node_file): New.
	(osdep_mkinst_files): Add parsing of mapper 'node' lines to 
	generate DSP Node files.  Delete special case for core environment.

2001-08-28  Robert Lipe  <robertl@caldera.com>

	* uw/osdep_make.c (osdep_mkinst_files): Add "R" flag to Master
	for pseudo devices.

2001-08-28  Robert Lipe  <robertl@caldera.com>

	* uw/osdep_make.c (osdep_mkinst_files): Correct ordering of CLASS.

2001-08-07  Robert Lipe  <robertl@caldera.com>

	* common/std_exec.c (_XOPEN_SOURCE_EXTENDED): Define to get
	Unix 95 symbols.

2001-08-07  Robert Lipe  <robertl@caldera.com>

	* common/set_abi.c (prepare_elf_object): Only do ELF64 symbol
	grinding when we have ELF64.
	* common/set_abi.c (abi_make_string_table_sprops): Make third arg
	a size_t.
	* common/common_api.h (abi_make_string_table_sprops): Likewise.

2001-08-06  Robert Lipe  <robertl@caldera.com>

	* darwin/osdep.mk (link.o): Fix dependencies.
	* freebsd/osdep.mk: Likewise.
	* linux/osdep.mk: Likewise.
	* osr5/osdep.mk: Likewise.
	* solaris/osdep.mk: Likewise.
	* uw/osdep.mk: Likewise.

2001-08-03  Burkhard Daniel  <burk@stg.com>

	* common/set_abi.h (prepare_elf_object): Use 8-Space tabs indentation.
	* linux/osdep_make.c (osdp_mkinst_files): Use snprintf instead sprintf
	for bounds checking.

2001-07-31  Burkhard Daniel  <burk@stg.com>

	* common/common_api.h (prepare_elf_object): Add "symbols" parameter.
	* common/set_abi.h (prepare_elf_object): If "symbols" argumen is 
	non-NULL, globalize all symbols in this array of char*'s.
	* darwin/osdep_make.c (osdep_mkinst_files): Pass NULL for
	prepare_elf_object's "symbols" parameter.
	* freebsd/osdep_make.c (osdep_mkinst_files): Pass NULL for
	prepare_elf_object's "symbols" parameter.
	* uw/osdep_make.c (osdep_mkinst_files): Pass NULL for
	prepare_elf_object's "symbols" parameter.
	* linux/osdep_make.c (osdep_mkinst_files): Rename "udi_MA" module to
	"udi" (tools part). Remove generation of sprops structure at udisetup
	time. Simplify glue generation. Globalize exported symbols for metas.

2001-07-31  Burkhard Daniel  <burk@stg.com>

	* common/spparse.y: Add new tokens "nohextext" and "nohexkeytext" to 
	resolve shift/reduce conflict in REQUIRES rule for mappers.

2001-07-30  Scott Popp  <spopp@caldera.com>

	* uw/osdep_make.c (osdep_mkinst_files): Insert code to not generate
	a postremove script for NIC drivers, to resolve pkgrm problems.

2001-07-30  Scott Popp  <spopp@caldera.com>

        * Makefile (MSG_FILES) Add compile.msg.
        * uw/osdep_make.c (osdep_mkinst_files): Fix typo in 'static' case.
        Fix trailing CR in generated Drvmap file.

2001-07-19  Robert Lipe  <robertl@sco.com>

        * osr5/osdep_make.c (generate_ID_list): Delete 'base' and all users.

2001-07-19  Scott Popp  <spopp@sco.com>
            Robert Lipe  <robertl@sco.com>

        * uw/osdep_make.c (make_bcfg): Delete base and all uses of it.
        (osdep_mkinst_files): Delete base and all uses of it.  Simplify
        Drvmap generation.   Correctly handle PCI class matches.

2001-07-17  Robert Lipe  <robertl@sco.com>

        * uw/osdep_make.c (osdep_mkinst_files): Conditionalize entrytype
        generation on target OS.

2001-07-17  Robert Lipe  <robertl@sco.com>
	
	* common/global.h (udi_global): Add disp_short.
	* common/param.c (I18Nstr32): Added.
	(udiutil_params): Add test for -i to udisetup.
	* common/udisetup.c (main) : Handle -i.

2001-07-16  Robert Lipe  <robertl@sco.com>

	Hoist compilation-specific code out of all objects except udibuild.

	* Makefile (compile.o): New target.
	* common/compile.c: New file.
	* common/common.c (get_ccfiles): Moved to compile.c.
	(incdir_matches): Likewise.
	(get_incdirs): Likewise.
	(get_ccopts): Likewise.

2001-07-13  Robert Lipe  <robertl@sco.com>

	* common/std_exec.c (os_getpax): Use OS_CPIO_OPTIONS.
	* uw/osdep.h (OS_CPIO_OPTIONS): Define.
	* uw/osdep.mk (CFLAGS): Optimize for size.
	* uw/osdep_make.c (osdep_mkinst_files): Preserve '$static' in sdevice.

2001-07-10  Robert Lipe  <robertl@sco.com>

	Add internal symlinks in pub_include/ to point to 'provide'ed 
	headers by metas and libraries.

	* common/global.h (provides_line_t): Added.
	(udi_global_data): Added pl_list, pl_tail.
	* common/spparse.y (do_udi_parse): Init them.
	(requires): Comment fix.
	(provides): New fn.   Called for each 'provides' line to preparse 
	and register data.
	* common/std_exec.c (os_mkdirp): New fn.  Makes a directory path.
	* common/udibuild.c (build_internal_headers): New fn.   Builds the
	internal copies or symlinks for provides data.
	(main): Call it.


2001-07-10  Robert Lipe  <robertl@sco.com>

	* uw/osdep_make.c (make_glue): For UnixWare 7, add a weak
	'udi_meta_info' symbol so we can always resolve it in 
	_udi_module_load even for libraries.

2001-06-30  Rob Tarte  <robt@PacificCodeWorks.com>
 
	* osr5/osdep_make.c:  Fixed copyright comments.
             
2001-06-21  Robert Lipe  <robertl@sco.com>

	* common/common.c (get_incdirs): Add -I line to compile for 
	each 'requires' in udiprops.
	* common/global.h (requires_line_t): New.
	(bin_type_t): Now an enum.
	(udi_global): Add rl_tail, rl_list.  Change type of bintype.
	* common/spparse.y: Accept headers in 'provides' lines.
	(do_udi_parse):  Empty rl_list, rl_tail.
	(requires): Added.
	* uw/link.c (os_link): Delete interim linker file.
	* uw/osdep_make.c (NUM_FIND): Delete.
	(make_glue): Add return value.
	(osdep_mkinst_files): Only compile glue if glue was really made.
	(KWQ_NO_LONGER_NEEDED): Deleted dead code.
	(osdep_mkinst_files): Install, reference 'provides' headers in
	consistent location.   Allow multiple headers to be installed.
	* uw/osdep_make.msg: Regenerate.
	
2001-06-14  Rob Tarte  <robt@PacificCodeWorks.com>

        * osr5/link.c: Added comment
        * osr5/obj_osdep.c: Fixed bogus warning that keeps Linux ELF's
        from installing.
        * osr5/obj_osdep.h (elf2coff, fix_static): Added prototypes
        * osr5/osdep.h: Turn on optimization and Pentium optimizations.
        * osr5/osdep.mk: turned off ELF generation for tools
        * osr5/osdep_make.c: Massive rework. Added support for:
        loading drivers in dependency order instead of mdevice order.
        Added requires to sprops.  Fixed permissions on scsihas.
        Fixed symbol name prefix to be unique.  Fixed permissions problem.
        Update scsihas so that mkdev hd works correctly.  Support scsi
        drivers with native name instead of udi_scsi.  Cleaned up package
        creation code.  Added the ability to do a pkgrm UDI drivers.
        Fixes for persistent attributes.  Added space.c and space.h generation
        code for persistent instance attributes.  Added more stubs so that
        UDI environment can be linked into a kernel without a UDI network
        driver.  Added more bus numbers and device numbers.  No more caps in
        device/system ID's.  List all unique system and subsystem ID's.
        This fixes netconfig so that it finds the device.

2001-06-10  Steven Bytnar <sbytnar@users.sourceforge.net>

	* darwin/link.c (os_link): Fixed nmedit namespace pollution remover.
	* darwin/set_abi_mach_o.c (set_abi_sprops): Any executed command
	should be displayed if udi_global.verbose is true.

2001-06-10  Steven Bytnar <sbytnar@users.sourceforge.net>

	* Makefile (MKBLDOBJS): Added dependency set_abi-$(OS_ENV).o.
	Otherwise, building Darwin will result in failing to build
	the tools because abi_make_string_table_sprops was not found.
	(common/udicmds): Added a workaround that allows UDI to build
	on OS's that lack gencat.
	($(BINDIR)/udimkpkg-$(OS_ENV)): Non-ELF OS's need to have access to
	abi_add_section_sizes and _set_abi_sprops.
	* common/common_api.h: Added function prototype for 
	abi_make_string_table_sprops, making it available and more sense
	to call from non-ELF ABIs.
	* common/set_abi.c (): Code motion. Renamed the core functionality
	of elf_putnewdata to abi_make_string_table_sprops. Made
	elf_putnewdata call this function.
	Wrapped ELF functions in UDI_ABI_ELF_UDIPROPS_SECTION.
	* darwin/set_abi_mach_o.c (set_abi_sprops): Removed unused variables.

2001-06-04  Robert Lipe  <robertl@sco.com>

        * uw/osdep_make.c (installing_on_711): Fix typo in var name.

2001-06-02  Steven Bytnar <sbytnar@users.sourceforge.net>

	* darwin/.cvsignore: Added.
	* darwin/DESIGN: Added.
	* darwin/NOTES: Added.
	* darwin/darwin_osexec.c: Added.
	* darwin/gencat: Added.
	* darwin/link.c: Added.
	* darwin/nl_types.h: Added.
	* darwin/osdep.h: Added.
	* darwin/osdep.mk: Added.
	* darwin/osdep_make.c: Added.
	* darwin/osdep_make.h: Added.
	* darwin/osdep_make.msg: Added.
	* darwin/props.c: Added.
	* darwin/set_abi_mach_o.c: Added.

2001-05-30  Robert Lipe  <robertl@sco.com>

        * uw/osdep_make.c (CRUTCH): Deleted.
        (installing_on_uw711): New.
        (set_os_version): New.
        osdep_mkinst_files: Replace 'CRUTCH' with runtime tests for
        'installing_on_uw711'.
        (make_glue): Likewise.

2001-05-30  Robert Lipe  <robertl@sco.com>

	* common/common.h (getloc): Add proto.
	(printhloc): Add proto.
	* common/common_api.h (prepare_elf_object): Add proto.
	* common/set_abi.c (prepare_elf_object): Make args const.

2001-05-21  Scott Popp  <spopp@sco.com>
	 
        Fix udisetup from source udi package.
 
        * common/set_abi.c (prepare_elf_object): Call elf_version.
        Set elf_class.

2001-05-21  Robert Lipe  <robertl@sco.com>

	* common/spparse.y (verify_filespec): Verify all the names in the
	list, not just the first.
	(verify_compopts): Implement.
	common/spparsey.msg: Regenerate. 

2001-05-03  Kevin Van Maren <vanmaren@users.sourceforge.net>

	* uw/osdep_make.c: Add back "ddi 8mp" line for NIC drivers
	since it is required by "netcfg" on UW711.

2001-04-27  Kevin Van Maren <vanmaren@users.sourceforge.net>

	* freebsd/osdep_make.c: Fix call to prepare_elf_object.
	Pointed out by Steve Bytnar

2001-04-20  Robert Lipe  <robertl@sco.com>

        * uw/osdep_make.c (osdep_mkinst_files): Init intfstr before use.

2001-04-18  Robert Lipe  <robertl@sco.com>

	* common/set_abi.c (add_elf_symbol): Replace symbol if it
	already exists.

2001-04-18  James Hall  <james.hall@sun.com>

	* common/set_abi.c: Add add_elf64_symbol ELF64 support routine
	* common/set_abi.c (prepare_elf_symbol): Use add_elf64_symbol as needed
	* common/set_abi.c (elf_geteshstrndx): Remove 'fprintf(stderr,' for 
	ELFCLASS64 format

2001-04-18  Burkhard Daniel  <burk@stg.com>

	* linux/osdep_make.c (output_glue_code): Renamed to output_glue_header
	(same): Adapt to new glue scheme, only output glue header.
	(osdep_mkinst_files): Adapt to new glue scheme. Output all footers.
	* linux/osdep_make.h: Modify glue headers & footers for the new glue
	scheme.

2001-04-17  Kevin Quick  <kevin.quick@surgient.com>

	* common/param.c: Generate proper message for mapper flag to
		  udimkpkg
	* common/udimkpkg.c (main): Only check text/data sizes if we are
		  making a standard file (i.e. not if make_mapper is set).

2001-04-17  Robert Lipe  <robertl@sco.com>

        * uw/osdep.h (OS_ALLOS_ARCHIVING): New.
        * common/udisetup.c (OS_ALLOW_ARCHIVING): Provide default.
        (install_comp): Test OS_ALLOW_ARCHIVING.

2001-04-17  Robert Lipe  <robertl@sco.com>

        * common/param.c (udiutil_params): Add mapper flag.
        * common/udibuild.c (main): Prescan for mapper flag.
        * common/udisetup.c (main): Prescan for mapper flag.
        * common/udimkpkg.c (main): Prescan for mapper flag.

2001-04-17  Robert Lipe  <robertl@sco.com>

	* common/udisetup.c (main): Use getopt to see if mapper.

2001-04-17  Kevin Quick <kquick@users.sourceforge.net>

	* common/common_api.h: Added abi_add_section_sizes function
	used to accumulate the section (text & data) sizes for object
	files using ABI-specific methods.  Also added ABI_SIZE_WARN_THRESH
	which is a global level at which the tools will begin to emit
	warnings relative to ABI limits.

	* common/set_abi.c: Made lots of internal functions "static".
	Added elf_snotempty and elf_stestflag to check if the section size
	is zero and test the section flags, respectively.  Added
	check_abiXX_sizes to check the text and data sizes relative to ABI
	limits (for ELF for now).

	* common/set_abi.msg: New messages for new ABI limits testing.

	* common/udimkpkg.c: Uses new ABI limits facilities to check the
	limits of each file and of the driver as a whole.

	* common/udimkpkg.msg: New messages for new ABI limits testing.
	
2001-04-16  Robert Lipe  <robertl@sco.com>

	* Makefile (real-install): Don't install tools binaries 
	if in xenv.
	* common/common.c (udi_tmpcopyinto) Backport Jame Hall's 
	2001-04-09 fix.
	* common/set_abi.msg: Regenerate.
	* common/spparse.y (requires): Add ability to parse non hex 
	strings for mappers.
	* common/udisetup.c (main): Walk arg list to see if we're a mapper.
	* uw/osdep_make.c (osdep_mkinst_files): Replace special cases 
	of $interface generation with general purpose derivation of 
	requires lines.
	(osdep_mkinst_files): Fix bug in interface definition for xenv.
	(make_glue): Add protos for _udi_module_load and _udi_module_unload.

2001-04-10  Kevin Van Maren <vanmaren@users.sourceforge.net>

	* freebsd/osdep_make.c: Remove prepare_elf_object (now in
	common/set_abi.c).

2001-04-09  Robert Lipe  <robertl@sco.com>

	Simplify for "new glue" scheme.

	* common/set_abi.c (add_elf_symbol): New helper function to add
	a symbol to an object.
	(prepare_elf_object) New.  Adds symbols to beginning and end
	of .udiprops scn.
	* common/set_abi.msg: Regenerate.
	* tools/uw/osdep_make.c (osdep_mkinst_files): Correctly use
	$ROOT/$MACH when in kernel build environment.
	(make_glue): Vastly simplify.   When on pre-OpenUnix 8 kernels,
	add a simple 1-line glue stub.   Otherwise, do nothing: No glue!
	(dbuf_add): Deleted.
	(dbuf_init): Deleted.
	(dbuf_repl): Deleted.
	(dbuf_save): Deleted.
	(obj_addstr): Deleted.
	(get_sh_name_idx): Deleted.
	(reqreorder): Deleted.

2001-04-09  James Hall <james-hall@users.sourceforge.net>

	* common/common.c (udi_tmpcopyinto): Fix directory copies
	(udi_tmpcopyinto): Ensure the whole source pathname is used as the
	copy source, not just the basename. Without this source packages with
	subdirectory components would fail.

2001-04-06  Kevin Van Maren <vanmaren@users.sourceforge.net>

	* Makefile: Fix blank-line separation between different make
	rules that was removed by inadvertant addition of line-
	continuation characters.

2001-03-29  Kevin Van Maren <vanmaren@users.sourceforge.net>

	* common/udisetup.c: Fix udisetup on multiple .udi file:
	Save/restore the current directory around the call to install_pkg,
	since install_pkg calls os_getpax which trashes the current dir.

2001-03-29  Robert Lipe <robertl@sco.com>

	* common/common.c (udi_tmpcopy): Fix formatting.
	(udi_tmpcopyinto): Preserve destination pathname through copy.

2001-03-27  Robert Lipe <robertl@sco.com>

	* freebsd/osdep_make.c (prepare_elf_object): Use printloc to
	internationalize error messages.
	(osdep_mkinst_files) Pass module name instead of shortname
	to prepare_elf_object.

2001-03-26  Robert Lipe <robertl@sco.com>

	* Makefile ($BINDIR/udicmds): More precise dependencies.
	($BINDIR)/udicmds.msg): Depends on MSG_FILES, not shell expansion.

2001-03-26  Robert Lipe <robertl@sco.com>

	* Makefile ($BINDIR/udicmds) More concise target.  Remove Perl checks.
	(BINDIR/udicmds.msg): Likewise.
	(BUILDOP): Remove Perl version checks.
	(OS_NAME/y.tab.c): Likewise.
	(OS_NAME/lex.yy.c): Likewise.

2001-03-24  Kevin Van Maren <vanmaren@cs.utah.edu>
	* tools/freebsd/osdep_make.c:
	Make sure to match the driver with its PCI id.
	Add the shrkudi driver ID.  Now trivial to hard-code more :-)
	Call device_set_description on a PCI ID match.
	Point -I at the GENERIC kernel build directory (still bad hack,
	but probably more likely to exist).
	Minor spelling/formatting nits.

2001-03-17  Robert Lipe <robertl@sco.com>

	Make tools (which are applications, not implementation) obey ISO 
	namespace rules about reserved identifiers.

	* common/common.c (__show_usage): Now show_usage.
	(_get_message): Now internal_get_message.
	* common/param.c (__set_std_arg): Now set_std_arg.
	(__set_nonstd_arg): Now set_nonstd_arg.
	(__show_usageline): Now show_usageline.
	(__show_help_usage): Now show_help_usage.
	(__show_usage): Now show_usage.
	(__invalid_value): Now invalid_value.	
	* common/spparse.y (END_CHK_PROP): Local var is now ecp_ii, not __ii.
	(check_prop): Local variable is now ii, not __ii.
	* linux/osdep_make.msg: Regenerated.

2001-02-26  Scott Popp <spopp@sco.com>

	* common/param.c (__set_nonstd_arg): Look in correct string for colon.

2001-02-21  Scott Popp <spopp@sco.com>

	This should be nearly all the work to fix the breakage of the
	internationalization of the UDI tools, when we began using the
	'new' tools.  Almost all of the work was to repair the displaying
	of the help menus.

	* common/param.c: Changed lots of code to allow internationalization
	  of all the help messages.  Routines affected were:
		- Added a bunch of #define's for internationalized string.
		- Modified udiutil_params to use the above new strings.
		- __set_std_arg to correctly parse the new strings.
		- __set_nonstd_arg to correctly parse the new strings.
		- print_size to send to stderr, to avoid 'garbling' of
		  stdout and stderr while printing.
		- __show_usageline to use the new internationalized strings.
		- __show_help_usage to remove the comment about
		  internationalization being broken, and add the
		  internationalization of the "Try -h for help" string.
		- __show_usage to use the new internationalized strings.
		- UDI_Util_Get_Params to use the new internationalized strings.
	* common/param.msg: Added mostly help related messaged added
	  for internationalization work metioned above.
	* common/getmsgs.pl: Modified the script to look for newly
	  internationalized strings.
	* common/common.c: Added the following routines:
		- printhloc, to directly print an internationalized message
		  to stderr.
		- getloc, to retrieve an internationalized message.

2001-02-17  Kevin Van Maren <vanmaren@cs.utah.edu>
	* freebsd/osdep_make.c (osdep_mkinst_files): Change // comments
	to #if 0 block.   (Left in for debugging.)

2001-02-16  Robert Lipe <robertl@sco.com>

	* common/set_abi.c (add_elf_symbol): New function.

2001-02-16  Robert Lipe <robertl@sco.com>

	Add preliminary FreeBSD support.

        * freebsd/link.c, freebsd/osdep.h freebsd/osdep.mk: New files.
        * freebsd/osdep_make.c: New files.

001-02-16  Robert Lipe <robertl@sco.com>

        * common/spparse.y (do_udiparse): Initialize udi_global.propdata
        for binary installs.
        * common/udisetup.c (main): Call set_binary_type to init udi_global.

